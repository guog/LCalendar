window.LCalendar=function(){var n=function(){this.gearDate;this.minY=1900;this.minM=1;this.minD=1;this.maxY=2099;this.maxM=12;this.maxD=31};return n.prototype={init:function(n){var r,t,i;this.type=n.type;this.trigger=document.querySelector(n.trigger);this.trigger.getAttribute("data-lcalendar")!=null&&(r=this.trigger.getAttribute("data-lcalendar").split(","),t=r[0].split("-"),this.minY=~~t[0],this.minM=~~t[1],this.minD=~~t[2],i=r[1].split("-"),this.maxY=~~i[0],this.maxM=~~i[1],this.maxD=~~i[2]);n.minDate&&(t=n.minDate.split("-"),this.minY=~~t[0],this.minM=~~t[1],this.minD=~~t[2]);n.maxDate&&(i=n.maxDate.split("-"),this.maxY=~~i[0],this.maxM=~~i[1],this.maxD=~~i[2]);this.bindEvent(this.type)},bindEvent:function(n){function c(){var s,h;t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消<\/div><div class="date_btn lcalendar_finish">确定<\/div><\/div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"><\/div><div class="date_grid"><div>年<\/div><\/div><\/div><div><div class="gear date_mm" data-datetype="date_mm"><\/div><div class="date_grid"><div>月<\/div><\/div><\/div><div><div class="gear date_dd" data-datetype="date_dd"><\/div><div class="date_grid"><div>日<\/div><\/div><\/div><\/div><\/div><\/div>';document.body.appendChild(t.gearDate);l();s=t.gearDate.querySelector(".lcalendar_cancel");s.addEventListener("touchstart",f);h=t.gearDate.querySelector(".lcalendar_finish");h.addEventListener("touchstart",nt);var n=t.gearDate.querySelector(".date_yy"),e=t.gearDate.querySelector(".date_mm"),o=t.gearDate.querySelector(".date_dd");n.addEventListener("touchstart",r);e.addEventListener("touchstart",r);o.addEventListener("touchstart",r);n.addEventListener("touchmove",u);e.addEventListener("touchmove",u);o.addEventListener("touchmove",u);n.addEventListener("touchend",i);e.addEventListener("touchend",i);o.addEventListener("touchend",i)}function l(){var i=new Date,n={yy:i.getFullYear(),mm:i.getMonth(),dd:i.getDate()-1};/^\d{4}-\d{1,2}-\d{1,2}$/.test(t.trigger.value)?(rs=t.trigger.value.match(/(^|-)\d{1,4}/g),n.yy=rs[0]-t.minY,n.mm=rs[1].replace(/-/g,"")-1,n.dd=rs[2].replace(/-/g,"")-1):n.yy=n.yy-t.minY;t.gearDate.querySelector(".date_yy").setAttribute("val",n.yy);t.gearDate.querySelector(".date_mm").setAttribute("val",n.mm);t.gearDate.querySelector(".date_dd").setAttribute("val",n.dd);e()}function a(){var o,s,n,e;t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消<\/div><div class="date_btn lcalendar_finish">确定<\/div><\/div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"><\/div><div class="date_grid"><div>年<\/div><\/div><\/div><div><div class="gear date_mm" data-datetype="date_mm"><\/div><div class="date_grid"><div>月<\/div><\/div><\/div><\/div><\/div><\/div>';document.body.appendChild(t.gearDate);v();o=t.gearDate.querySelector(".lcalendar_cancel");o.addEventListener("touchstart",f);s=t.gearDate.querySelector(".lcalendar_finish");s.addEventListener("touchstart",tt);n=t.gearDate.querySelector(".date_yy");e=t.gearDate.querySelector(".date_mm");n.addEventListener("touchstart",r);e.addEventListener("touchstart",r);n.addEventListener("touchmove",u);e.addEventListener("touchmove",u);n.addEventListener("touchend",i);e.addEventListener("touchend",i)}function v(){var i=new Date,n={yy:i.getFullYear(),mm:i.getMonth()};/^\d{4}-\d{1,2}$/.test(t.trigger.value)?(rs=t.trigger.value.match(/(^|-)\d{1,4}/g),n.yy=rs[0]-t.minY,n.mm=rs[1].replace(/-/g,"")-1):n.yy=n.yy-t.minY;t.gearDate.querySelector(".date_yy").setAttribute("val",n.yy);t.gearDate.querySelector(".date_mm").setAttribute("val",n.mm);e()}function y(){var e,o,n;t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消<\/div><div class="date_btn lcalendar_finish">确定<\/div><\/div><div class="date_roll_mask"><div class="y_roll"><div><div class="gear date_yy" data-datetype="date_yy"><\/div><div class="date_grid"><div ">年<\/div><\/div><\/div><\/div><\/div><\/div>';document.body.appendChild(t.gearDate);p();e=t.gearDate.querySelector(".lcalendar_cancel");e.addEventListener("touchstart",f);o=t.gearDate.querySelector(".lcalendar_finish");o.addEventListener("touchstart",it);n=t.gearDate.querySelector(".date_yy");n.addEventListener("touchstart",r);n.addEventListener("touchmove",u);n.addEventListener("touchend",i)}function p(){var i=new Date,n={yy:i.getFullYear()};/^\d{4}$/.test(t.trigger.value)?(rs=t.trigger.value.match(/\d{1,4}/g),n.yy=rs[0]-t.minY):n.yy=n.yy-t.minY;t.gearDate.querySelector(".date_yy").setAttribute("val",n.yy);e()}function w(){var c,l;t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消<\/div><div class="date_btn lcalendar_finish">确定<\/div><\/div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"><\/div><div class="date_grid"><div>年<\/div><\/div><\/div><div><div class="gear date_mm" data-datetype="date_mm"><\/div><div class="date_grid"><div>月<\/div><\/div><\/div><div><div class="gear date_dd" data-datetype="date_dd"><\/div><div class="date_grid"><div>日<\/div><\/div><\/div><div><div class="gear time_hh" data-datetype="time_hh"><\/div><div class="date_grid"><div>时<\/div><\/div><\/div><div><div class="gear time_mm" data-datetype="time_mm"><\/div><div class="date_grid"><div>分<\/div><\/div><\/div><\/div><\/div><\/div>';document.body.appendChild(t.gearDate);b();c=t.gearDate.querySelector(".lcalendar_cancel");c.addEventListener("touchstart",f);l=t.gearDate.querySelector(".lcalendar_finish");l.addEventListener("touchstart",rt);var n=t.gearDate.querySelector(".date_yy"),e=t.gearDate.querySelector(".date_mm"),o=t.gearDate.querySelector(".date_dd"),s=t.gearDate.querySelector(".time_hh"),h=t.gearDate.querySelector(".time_mm");n.addEventListener("touchstart",r);e.addEventListener("touchstart",r);o.addEventListener("touchstart",r);s.addEventListener("touchstart",r);h.addEventListener("touchstart",r);n.addEventListener("touchmove",u);e.addEventListener("touchmove",u);o.addEventListener("touchmove",u);s.addEventListener("touchmove",u);h.addEventListener("touchmove",u);n.addEventListener("touchend",i);e.addEventListener("touchend",i);o.addEventListener("touchend",i);s.addEventListener("touchend",i);h.addEventListener("touchend",i)}function b(){var i=new Date,n={yy:i.getFullYear(),mm:i.getMonth(),dd:i.getDate()-1,hh:i.getHours(),mi:i.getMinutes()};/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(t.trigger.value)?(rs=t.trigger.value.match(/(^|-|\s|:)\d{1,4}/g),n.yy=rs[0]-t.minY,n.mm=rs[1].replace(/-/g,"")-1,n.dd=rs[2].replace(/-/g,"")-1,n.hh=parseInt(rs[3].replace(/\s0?/g,"")),n.mi=parseInt(rs[4].replace(/:0?/g,""))):n.yy=n.yy-t.minY;t.gearDate.querySelector(".date_yy").setAttribute("val",n.yy);t.gearDate.querySelector(".date_mm").setAttribute("val",n.mm);t.gearDate.querySelector(".date_dd").setAttribute("val",n.dd);e();t.gearDate.querySelector(".time_hh").setAttribute("val",n.hh);t.gearDate.querySelector(".time_mm").setAttribute("val",n.mi);s()}function k(){var o,s,n,e;t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消<\/div><div class="date_btn lcalendar_finish">确定<\/div><\/div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"><\/div><div class="date_grid"><div>时<\/div><\/div><\/div><div><div class="gear time_mm" data-datetype="time_mm"><\/div><div class="date_grid"><div>分<\/div><\/div><\/div><\/div><\/div><\/div>';document.body.appendChild(t.gearDate);d();o=t.gearDate.querySelector(".lcalendar_cancel");o.addEventListener("touchstart",f);s=t.gearDate.querySelector(".lcalendar_finish");s.addEventListener("touchstart",ut);n=t.gearDate.querySelector(".time_hh");e=t.gearDate.querySelector(".time_mm");n.addEventListener("touchstart",r);e.addEventListener("touchstart",r);n.addEventListener("touchmove",u);e.addEventListener("touchmove",u);n.addEventListener("touchend",i);e.addEventListener("touchend",i)}function d(){var i=new Date,n={hh:i.getHours(),mm:i.getMinutes()};/^\d{2}:\d{2}$/.test(t.trigger.value)&&(rs=t.trigger.value.match(/(^|:)\d{2}/g),n.hh=parseInt(rs[0].replace(/^0?/g,"")),n.mm=parseInt(rs[1].replace(/:0?/g,"")));t.gearDate.querySelector(".time_hh").setAttribute("val",n.hh);t.gearDate.querySelector(".time_mm").setAttribute("val",n.mm);s()}function e(){var y=t.maxY-t.minY+1,r,e,f,n,w,o,s,i;if(t.gearDate!=null){if(r=t.gearDate.querySelector(".date_yy"),e="",r&&r.getAttribute("val")){for(f=parseInt(r.getAttribute("val")),i=0;i<=y-1;i++)e+="<div class='tooth'>"+(t.minY+i)+"<\/div>";r.innerHTML=e;n=Math.floor(parseFloat(r.getAttribute("top")));isNaN(n)?(r.style["-webkit-transform"]="translate3d(0,"+(8-f*2)+"em,0)",r.setAttribute("top",8-f*2+"em")):(n=n%2==0?n:n+1,n>8&&(n=8),w=8-(y-1)*2,n<w&&(n=w),r.style["-webkit-transform"]="translate3d(0,"+n+"em,0)",r.setAttribute("top",n+"em"),f=Math.abs(n-8)/2,r.setAttribute("val",f))}else return;if(o=t.gearDate.querySelector(".date_mm"),o&&o.getAttribute("val")){e="";var u=parseInt(o.getAttribute("val")),v=11,a=0;for(f==y-1&&(v=t.maxM-1),f==0&&(a=t.minM-1),i=0;i<v-a+1;i++)e+="<div class='tooth'>"+(a+i+1)+"<\/div>";o.innerHTML=e;u>v?(u=v,o.setAttribute("val",u)):u<a&&(u=v,o.setAttribute("val",u));o.style["-webkit-transform"]="translate3d(0,"+(8-(u-a)*2)+"em,0)";o.setAttribute("top",8-(u-a)*2+"em")}else return;if(s=t.gearDate.querySelector(".date_dd"),s&&s.getAttribute("val")){e="";var c=parseInt(s.getAttribute("val")),b=h(f,u),p=b-1,l=0;for(f==y-1&&t.maxM==u+1&&(p=t.maxD-1),f==0&&t.minM==u+1&&(l=t.minD-1),i=0;i<p-l+1;i++)e+="<div class='tooth'>"+(l+i+1)+"<\/div>";s.innerHTML=e;c>p?(c=p,s.setAttribute("val",c)):c<l&&(c=l,s.setAttribute("val",c));s.style["-webkit-transform"]="translate3d(0,"+(8-(c-l)*2)+"em,0)";s.setAttribute("top",8-(c-l)*2+"em")}else return}}function s(){var i,f,r,u,e,n;if(t.gearDate!=null){if(i=t.gearDate.querySelector(".time_hh"),i&&i.getAttribute("val")){for(u="",f=parseInt(i.getAttribute("val")),n=0;n<=23;n++)u+="<div class='tooth'>"+n+"<\/div>";i.innerHTML=u;i.style["-webkit-transform"]="translate3d(0,"+(8-f*2)+"em,0)";i.setAttribute("top",8-f*2+"em")}else return;if(r=t.gearDate.querySelector(".time_mm"),r&&r.getAttribute("val")){for(u="",e=parseInt(r.getAttribute("val")),n=0;n<=59;n++)u+="<div class='tooth'>"+n+"<\/div>";r.innerHTML=u;r.style["-webkit-transform"]="translate3d(0,"+(8-e*2)+"em,0)";r.setAttribute("top",8-e*2+"em")}else return}}function h(n,i){return i==1?(n+=t.minY,n%4==0&&n%100!=0||n%400==0&&n%4e3!=0?29:28):i==3||i==5||i==8||i==10?30:31}function r(n){var t,i;for(n.preventDefault(),t=n.target;;)if(t.classList.contains("gear"))break;else t=t.parentElement;clearInterval(t["int_"+t.id]);t["old_"+t.id]=n.targetTouches[0].screenY;t["o_t_"+t.id]=(new Date).getTime();i=t.getAttribute("top");t["o_d_"+t.id]=i?parseFloat(i.replace(/em/g,"")):0;t.style.webkitTransitionDuration=t.style.transitionDuration="0ms"}function u(n){var t,r;for(n.preventDefault(),t=n.target;;)if(t.classList.contains("gear"))break;else t=t.parentElement;t["new_"+t.id]=n.targetTouches[0].screenY;t["n_t_"+t.id]=(new Date).getTime();r=(t["new_"+t.id]-t["old_"+t.id])*30/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+r;t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)";t.setAttribute("top",t["pos_"+t.id]+"em");n.targetTouches[0].screenY<1&&i(n)}function i(n){var t,i;for(n.preventDefault(),t=n.target;;)if(t.classList.contains("gear"))break;else t=t.parentElement;i=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);t["spd_"+t.id]=Math.abs(i)<=.2?i<0?-.08:.08:Math.abs(i)<=.5?i<0?-.16:.16:i/2;t["new_"+t.id]&&t["n_t_"+t.id]||(t["spd_"+t.id]=0);t["pos_"+t.id]||(t["pos_"+t.id]=0);g(t)}function g(n){function i(){n.style.webkitTransitionDuration=n.style.transitionDuration="200ms";r=!0}var f=0,r=!1,u=t.maxY-t.minY+1;clearInterval(n["int_"+n.id]);n["int_"+n.id]=setInterval(function(){var e,a,w,c,s;if(t.gearDate!=null){e=n["pos_"+n.id];a=n["spd_"+n.id]*Math.exp(-.03*f);e+=a;Math.abs(a)>.1||(w=Math.round(e/2)*2,e=w,i());e>8&&(e=8,i());switch(n.dataset.datetype){case"date_yy":c=8-(u-1)*2;e<c&&(e=c,i());r&&(s=Math.abs(e-8)/2,o(n,s),clearInterval(n["int_"+n.id]));break;case"date_mm":var b=t.gearDate.querySelector(".date_yy"),l=parseInt(b.getAttribute("val")),k=11,v=0;l==u-1&&(k=t.maxM-1);l==0&&(v=t.minM-1);c=8-(k-v)*2;e<c&&(e=c,i());r&&(s=Math.abs(e-8)/2+v,o(n,s),clearInterval(n["int_"+n.id]));break;case"date_dd":var b=t.gearDate.querySelector(".date_yy"),g=t.gearDate.querySelector(".date_mm"),l=parseInt(b.getAttribute("val")),y=parseInt(g.getAttribute("val")),nt=h(l,y),d=nt-1,p=0;l==u-1&&t.maxM==y+1&&(d=t.maxD-1);l==0&&t.minM==y+1&&(p=t.minD-1);c=8-(d-p)*2;e<c&&(e=c,i());r&&(s=Math.abs(e-8)/2+p,o(n,s),clearInterval(n["int_"+n.id]));break;case"time_hh":e<-38&&(e=-38,i());r&&(s=Math.abs(e-8)/2,o(n,s),clearInterval(n["int_"+n.id]));break;case"time_mm":e<-110&&(e=-110,i());r&&(s=Math.abs(e-8)/2,o(n,s),clearInterval(n["int_"+n.id]))}n["pos_"+n.id]=e;n.style["-webkit-transform"]="translate3d(0,"+e+"em,0)";n.setAttribute("top",e+"em");f++}},30)}function o(n,t){t=Math.round(t);n.setAttribute("val",t);/date/.test(n.dataset.datetype)?e():s()}function f(n){n.preventDefault();var i;try{i=new CustomEvent("input")}catch(n){i=document.createEvent("Event");i.initEvent("input",!0,!0)}t.trigger.dispatchEvent(i);document.body.removeChild(t.gearDate);t.gearDate=null}function nt(n){var u=t.maxY-t.minY+1,e=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(t.gearDate.querySelector(".date_mm").getAttribute("val")))+1,i;r=r>9?r:"0"+r;i=parseInt(Math.round(t.gearDate.querySelector(".date_dd").getAttribute("val")))+1;i=i>9?i:"0"+i;t.trigger.value=e%u+t.minY+"-"+r+"-"+i;f(n)}function tt(n){var r=t.maxY-t.minY+1,u=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val"))),i=parseInt(Math.round(t.gearDate.querySelector(".date_mm").getAttribute("val")))+1;i=i>9?i:"0"+i;t.trigger.value=u%r+t.minY+"-"+i;f(n)}function it(n){var i=t.maxY-t.minY+1,r=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val")));t.trigger.value=r%i+t.minY;f(n)}function rt(n){var o=t.maxY-t.minY+1,s=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val"))),e=parseInt(Math.round(t.gearDate.querySelector(".date_mm").getAttribute("val")))+1,u,i,r;e=e>9?e:"0"+e;u=parseInt(Math.round(t.gearDate.querySelector(".date_dd").getAttribute("val")))+1;u=u>9?u:"0"+u;i=parseInt(Math.round(t.gearDate.querySelector(".time_hh").getAttribute("val")));i=i>9?i:"0"+i;r=parseInt(Math.round(t.gearDate.querySelector(".time_mm").getAttribute("val")));r=r>9?r:"0"+r;t.trigger.value=s%o+t.minY+"-"+e+"-"+u+" "+(i.length<2?"0":"")+i+(r.length<2?":0":":")+r;f(n)}function ut(n){var r=parseInt(Math.round(t.gearDate.querySelector(".time_hh").getAttribute("val"))),i;r=r>9?r:"0"+r;i=parseInt(Math.round(t.gearDate.querySelector(".time_mm").getAttribute("val")));i=i>9?i:"0"+i;t.trigger.value=(r.length<2?"0":"")+r+(i.length<2?":0":":")+i;f(n)}var t=this;t.trigger.addEventListener("touchend",{y:y,ym:a,date:c,datetime:w,time:k}[n])}},n}();